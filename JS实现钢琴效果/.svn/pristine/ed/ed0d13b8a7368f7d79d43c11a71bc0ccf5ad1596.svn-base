import { constantRouterMap } from '@/router/index'
import { getToken } from '@/utils/auth'

const permission = {
  state: {
    routers: constantRouterMap,
    addRouters: [],
    token: '',
    sessionId: ''
  },
  mutations: {
    SET_ROUTERS: (state, routers) => {
		console.log("ssss")
      state.addRouters = routers
     // state.routers = constantRouterMap.concat(routers)
		 state.routers = routers
				console.log(routers)
				console.log("ssss")
      // state.addRouters = asyncRouterMap
      // state.routers = constantRouterMap.concat(asyncRouterMap)
    },
    SET_TOKEN: (state, token) => {
      state.token = token
    },
    SET_SESSIONID: (state, sessionId) => {
      state.sessionId = sessionId
    }
  },
  actions: {
		async SetRoute({ commit, state }, params) {
				console.log(params)
   
      commit('SET_ROUTERS', params.r)
      params.cb()
    },
    SetToken({ commit }) {
      return new Promise((resolve, reject) => {
        const token = getToken()
        if (token) {
          // 获取用户菜单时使用， 确保是登录过的
					Cookies.set('Token', response.data.token)
          commit('SET_TOKEN', token)
          resolve()
        } else {
          reject()
        }
      })
    },
    SetSessionId({ commit }) {
      return new Promise((resolve, reject) => {
        const sessionId = getToken()
        if (sessionId) {
          // 获取用户菜单时使用， 确保是登录过的
          commit('SET_SESSIONID', sessionId)
          resolve()
        } else {
          reject()
        }
      })
    }
  }
}

export default permission
